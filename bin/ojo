#!/usr/bin/env ruby

require 'awesome_print'
require File.expand_path('../../lib/ojo', __FILE__)

options = Ojo.parse_it_baby

Ojo.initialize_current_directory(options) if options[:initialize]

settings = Ojo.read_config_file
settings.merge!(options) if options && settings

Ojo.location = settings[:path]
Ojo.clear_results if options[:clear]

unless options[:initialize] || options[:clear]

  location_base = Ojo.location

  unless location_base
    puts 'you need a location before we can continue'
    exit
  end

  unless settings[:branch_1]
    puts 'you need a first branch name'
    exit
  end

  unless settings[:branch_2]
    puts 'you need a second branch name'
    exit
  end

  all_same, results = Ojo.compare(settings[:branch_1], settings[:branch_2])
  Ojo.display_to_console results

  if settings[:open]
    `open #{location_base}` if Dir.exist?(location_base)
  end
end
